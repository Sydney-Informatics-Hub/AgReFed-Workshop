{
  "hash": "615d62af6b9edfcc416b7e3aff95d23d",
  "result": {
    "markdown": "---\ntitle: \"{{< fa brands r-project >}} Introduction\"\n\n---\n\n\n\n\n\n:::{.callout-tip}\n## In this workshop\n\n1. Learn about AgReFed and the `dataharvester` package\n2. Use `dataharvester` to access and analyse data with a YAML configuration file\n3. Preview and manipulate downloaded data in GeoTIFF and .csv formats\n:::\n\n## Introduction\n\nHello and welcome to **Session 1**. In this session, we will learn about AgReFed and the `dataharvester` package and access data with a YAML configuration file.\n\n<!-- In **Workshop 2**, we will preview and manipulate downloaded data manually without the YAML config, and explore some Google Earth Engine functionality.\n\n**Workshop 3** will introduce to you some of the more advanced features of `dataharvester` including the ability to preprocess data and create custom data products. -->\n\n::: callout-note\n**We highly recommend you to run the workshop in RStudio Cloud.** Make sure that you have looked at [Setting up R](/rdocs/r01-setup.qmd) as you must authenticate to Google Earth Engine (GEE) to access some data.\n:::\n\n##  [{{< fa person-chalkboard >}} Demo 1: Authentication]{style=\"color: green;\"}\n\n::: {.callout-tip icon=\"false\"}\n## Agenda\n\nIn this demo, we will: \n\n- Check that your `reticulate` environment is set up correctly\n- Intialise Google Earth Engine (GEE), and authenticate to a Google account\n\n:::\n\nRun the following code in your RStudio session:\n\n```r\nlibrary(dataharvester)\ninitialise_harvester(\"r-reticulate\")\n```\nThe function will verify that the environment `\"r-reticulate\"` is available and contains all the required dependencies. \n\nOnce this is complete, you may want to authenticate to Google Earth Engine (GEE). To do this, add the following argument to the same code:\n\n```r\ninitialise_harvester(\"r-reticulate\", earthengine = TRUE)\n```\n\nThe function will now try to authenticate to Google Earth Engine. This might involve opening a browser window and copying a code into the console. \n\n##  [{{< fa person-chalkboard >}} Demo 2: YAML config]{style=\"color: green;\"}\n\n::: {.callout-tip icon=\"false\"}\n## Agenda\n\nTo warm-up, we will:\n\n1. Learn about YAML configuration files\n2. Explore a basic and a more \"advanced\" YAML config\n3. Run a simple YAML file to download data\n\n:::\n\n\n\nThe Data-Harvester uses a YAML configuration file to perform bulk downloads in a single command.\n\n::: {.callout-caution collapse=\"true\"}\n### What is YAML?\nYAML is a human-readable data-serialization language. It is commonly used for configuration files and in applications where data is being stored or transmitted. YAML files are easy to read and write, and are often used to configure software applications. A typical YAML file looks like this:\n\n```yaml\n---\nname: \"John Smith\"\nage: 42\noccupation: \"gardener\"\n```\n\nLooks familiar? If you have used Markdown or R Markdown, YAML is used to define the metadata for the document.\n\nA YAML configuration file helps to keep track of the data you have downloaded and the analyses you have performed. It also allows you to easily reproduce your analyses and share them with others.\n:::\n\n\n\n#### Basic usage\n\nBelow is the YAML file for `basic_config.yaml` which can be found in the `assets` folder in RStudio Cloud. The file can also be downloaded from the [GitHub repository]().\n\n```yaml\n---\noutpath: downloads/\ntarget_bbox: [149.769345, -30.335861, 149.949173, -30.206271]\ntarget_dates: [2021]\ntarget_res: 6.0\ntarget_sources:\n  DEA: [landsat_barest_earth]\n```\nTo run the configuration file, we use the `harvest()` function. The function takes a single argument, `path_to_config`, which is the path to the YAML file. The path can be either relative or absolute.\n\n::: {.callout-caution collapse=\"true\"}\n\n### Relative and absolute path strings\nA relative path is a path that is relative to the current working directory. For example, if you are working in the `dataharvester` directory, the path to the `basic_config.yaml` file, stored in the `assets` folder, is `assets/basic_config.yaml`.\n\nAn absolute path is a path that starts from the root directory. For example, the absolute path to the `basic_config.yaml` file might be `/home/rstudio/dataharvester/assets/basic_config.yaml` (note: this is not the actual path to the file).\n\n**Both paths point to the same file.**\n\nRelative paths are useful when you are working in a project directory, as they are shorter and easier to remember. Relative paths also allow you to share your code with others, as they will not need to change the path in the configuration file as long as they are working in the same folder. Absolute paths are useful when you are working in a different directory, or when you are working on a local machine.\n:::\n\n```r\nharvest(\"assets/basic_config.yaml\")\n```\nSeveral optional arguments are available to customise the output of `harvest()`:\n\n- `log_name`: the name of the log file output which stores some information about the download. The default is `\"download_log.txt\"`.\n- `preview`: if `TRUE`, the function will preview the output raster data\n- `contour`: if `TRUE`, the function will add a contour plot to the output raster data\n\n```r\nharvest(\"assets/basic_config.yaml\", \n  log_name = \"basic_config\", \n  preview = TRUE, \n  contour = TRUE)\n```\n\nIf you run the same config again, he function recognises that a file has been downloaded and will not re-download it. This is useful if you want to re-run the configuration file to add more data sources -- we will see this in action later.\n\n#### Adding multiple data sources\n\nAdditional data sources can be added to the configuration file by adding a new key to the `target_sources` list. Below we have added sources from DEM, Landscape, SILO and SLGA collections. Copy the new lines and add them to `basic_config.yaml`:\n\n```yaml\n---\noutpath: downloads/\ntarget_bbox: [149.769345, -30.335861, 149.949173, -30.206271]\ntarget_dates: [2021]\ntarget_res: 6.0\n\ntarget_sources:\n  DEA: [landsat_barest_earth]\n  # add the new lines below --------------------\n  DEM: [DEM]\n  Landscape: [Relief_300m]\n  SILO:\n    monthly_rain: [sum]\n  SLGA:\n    Bulk_Density: [0-5cm]\n    Clay: [0-5cm]\n```\n\nLet's run the above configuration file and preview the output data. You should already have the `DEA` data downloaded, so the function will only download the new data sources. In addition, the `preview` and `contour` arguments have been set to `TRUE` to preview the output data. We will also create a new log file, called `\"multi_config.txt\"` for this run.\n\n```r\nharvest(\"assets/multi_config.yaml\", \n  log_name = \"multi_config\", \n  preview = TRUE, \n  contour = TRUE)\n```\n\n## [{{< fa keyboard >}} Exercise 1: Update config]{style=\"color: blue;\"}\n\n::: {.callout-note icon=\"false\"}\n## {{< fa keyboard >}} On your own\n\nRefer to the [YAML Overview](/Settings_Overview.md) section and update the `basic_config.yaml` file to download the following data sources:\n\n- Slope and aspect from the Landscape collection\n- Total (sum) maximum temperature from the SILO collection\n\nThen, run `harvest()` on the configuration file and preview the output.\n\n:::\n\n::: {.callout-caution icon=\"false\" collapse=\"true\"}\n## {{< fa keyboard >}} Solution\n\n```yaml\n---\noutpath: downloads/\ntarget_bbox: [149.769345, -30.335861, 149.949173, -30.206271]\ntarget_dates: [2021]\ntarget_res: 6.0\n\ntarget_sources:\n  DEA: [landsat_barest_earth]\n  DEM: [DEM]\n  Landscape: [Relief_300m, Slope, Aspect]  # <- edit this line\n  SILO:\n    monthly_rain: [sum]\n    max_temp: [sum]  # <- add this line\n  SLGA:\n    Bulk_Density: [0-5cm]\n    Clay: [0-5cm]\n```\n:::\n\n##  [{{< fa person-chalkboard >}} Demo 3: Google Earth Engine]{style=\"color: green;\"}\n\n\n::: {.callout-tip icon=\"false\"}\n## Agenda\n\nTime to tap into the Google Earth Engine API. This demo will:\n\n- Introduce using the YAML configuration file to download data from Google Earth Engine\n- Discuss what can and cannot be done with the YAML configuration file\n\n:::\n\nWe will continue to use the same configuration file, `basic_config.yaml`, to download data from **Google Earth Engine**. Below, we add a new key to the `target_sources` list, called `GEE`. **Workshop 2** will cover how to use the GEE API in more detail, but for now, we will preview how the YAML configuration file can be used download data from GEE.\n\n\n```yaml\n---\ninfile:  \noutpath: downloads/\ncolname_lat:  \ncolname_lng:  \ntarget_bbox: [149.769345, -30.335861, 149.949173, -30.206271]\ntarget_dates: [2021]\ntarget_res: 6.0\n\ntarget_sources:\n  DEA: [landsat_barest_earth]\n  DEM: [DEM]\n  Landscape: [Relief_300m, Slope, Aspect]  \n  SILO:\n    monthly_rain: [sum]\n    max_temp: [sum] \n  SLGA:\n    Bulk_Density: [0-5cm]\n    Clay: [0-5cm]\n  # add the new lines below --------------------\n  GEE:\n    preprocess:\n      collection: LANDSAT/LC09/C02/T1_L2\n      mask_clouds: True\n      reduce: median\n      spectral: [NDVI]\n    download:\n      bands: [NDVI, SR_B2, SR_B3, SR_B4]\n      scale: 100\n```\nThe configuration will download a Landsat 9 images for the year 2021, composite them all to a single image using the `median` reducer, and calculate the `NDVI` spectral index. The output image will be downloaded as a GeoTIFF file, with the `NDVI` spectral index and the RGB bands (`SR_B2`, `SR_B3`, `SR_B4`) included in the raster image.\n\n## [{{< fa keyboard >}} Exercise 2: GEE config]{style=\"color: blue;\"}\n\n::: {.callout-note icon=\"false\"}\n## {{< fa keyboard >}} On your own\n\nLet's download from a different data source by referring to the [Earth Engine Data Catalog](https://developers.google.com/earth-engine/datasets/catalog). Have a look at the different sections and tabs (Description\nBands, Image Properties, Terms of Use).\n\n**Task**\n\nChange the `collection` attribute in `basic_config.yaml` to one of [Landsat](https://developers.google.com/earth-engine/datasets/catalog/landsat), [Sentinel](https://developers.google.com/earth-engine/datasets/catalog/sentinel) or [MODIS](https://developers.google.com/earth-engine/datasets/catalog/modis) **surface reflectance** collections. Then, run `harvest()` on the configuration file and preview the output.\n\n**Questions**\n\n- What happens when you provide an incorrect dataset name?\n- Which other attribute(s) needed to be changed in the configuration file to download data from a different collection?\n- What happens when you provide an incorrect band name?\n\n:::\n\nYour instructor will discuss this exercise in the next workshop.\n\n## Wrapping up\n\nThis is the end of **Workshop 1**. In this workshop we have covered setup and using the YAML connfiguration file to download from multiple API sources. In the next workshop ([**Workshop 2**](/rdocs/r03-basic.qmd)), we will cover how to use individual download functions to create custom workflows for downloading data.\n\nSee you there!\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}